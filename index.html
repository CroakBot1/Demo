<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>50 Pairs Demo â€” Charts + Indicators</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <style>
    :root{
      --bg:#0b0f1a; --card:#0f1724; --accent:#06d6a0; --muted:#9ad1c1;
    }
    body{margin:0;font-family:Inter, Arial, Helvetica, sans-serif;background:var(--bg);color:#e6eef6;padding:12px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    h1{margin:0;font-size:18px;color:var(--accent)}
    .controls{margin-left:auto}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px}
    .pair{background:var(--card);border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:10px;box-shadow:0 4px 18px rgba(0,0,0,0.6)}
    .pair h4{margin:0 0 6px;font-size:13px;color:var(--accent)}
    .meta{display:flex;justify-content:space-between;align-items:center;font-size:12px;margin-top:6px}
    .price{font-weight:700}
    canvas{width:100%!important;height:90px!important}
    /* Toasts */
    #toastContainer{position:fixed;top:18px;right:18px;z-index:9999;display:flex;flex-direction:column;align-items:flex-end;gap:8px}
    .toast{padding:10px 12px;border-radius:8px;color:#fff;font-weight:700;box-shadow:0 6px 20px rgba(0,0,0,0.6)}
    .toast.buy{background:#157f3a}
    .toast.sell{background:#7f1414}
    .toast.hold{background:#a67b00;color:#111}
    .muted{color:var(--muted);font-size:12px}
    @media (max-width:600px){ .grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))} }
  </style>
</head>
<body>

<header>
  <h1>ðŸ“¡ Demo Trading Bot â€” 50 Pairs (Indicators)</h1>
  <div class="controls muted">Simulated prices Â· Indicators: SMA/EMA/Bollinger/RSI/MACD</div>
</header>

<main>
  <div class="grid" id="pairsGrid"></div>
</main>

<!-- Toasts -->
<div id="toastContainer"></div>

<!-- Sounds -->
<audio id="soundBuy" preload="auto" src="https://actions.google.com/sounds/v1/animals/frog_croak.ogg"></audio>
<audio id="soundSell" preload="auto" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="soundHold" preload="auto" src="https://actions.google.com/sounds/v1/alarms/ding.ogg"></audio>

<script>
/* ---------- Setup pairs ---------- */
const coins = ["BTC","ETH","BNB","SOL","XRP","ADA","DOGE","DOT","MATIC","LTC",
               "AVAX","SHIB","UNI","LINK","ATOM","XLM","ETC","FIL","APT","NEAR",
               "ICP","HBAR","VET","GRT","AAVE","SAND","MANA","AXS","EGLD","THETA",
               "XTZ","CHZ","EOS","FLOW","KSM","CRV","CAKE","DYDX","RUNE","1INCH",
               "ZIL","XMR","DASH","WAVES","KAVA","NEO","FTM","ALGO","OKB","PEPE"];

const pairs = coins.map(c => ({
  name: c + "/USDT",
  prices: generateInitialPrices(40),
  charts: { main: null },
}));

const grid = document.getElementById('pairsGrid');

pairs.forEach((pair, idx) => {
  const el = document.createElement('div');
  el.className = 'pair';
  el.innerHTML = `
    <h4>${pair.name}</h4>
    <canvas id="c${idx}"></canvas>
    <div class="meta">
      <div class="muted">Price</div>
      <div><span class="price" id="p${idx}">-</span></div>
    </div>
  `;
  grid.appendChild(el);

  const ctx = document.getElementById(`c${idx}`).getContext('2d');
  const cfg = {
    type: 'line',
    data: {
      labels: pair.prices.map((_, i) => i),
      datasets: [
        { label: 'Price', data: pair.prices.slice(), borderColor: '#06d6a0', borderWidth: 1, pointRadius: 0, tension:0.3 },
        { label: 'SMA5', data: [], borderColor: '#ffd166', borderWidth: 1, pointRadius:0, tension:0.3 },
        { label: 'EMA12', data: [], borderColor: '#ef476f', borderWidth: 1, pointRadius:0, tension:0.3 },
        { label: 'BBU', data: [], borderColor: '#577590', borderWidth: 1, borderDash: [4,3], pointRadius:0, tension:0.3 },
        { label: 'BBL', data: [], borderColor: '#577590', borderWidth: 1, borderDash: [4,3], pointRadius:0, tension:0.3 },
        { label: 'MACD_hist', data: [], backgroundColor: [], type:'bar', yAxisID:'y', barThickness:6 },
        { label: 'MACD_line', data: [], borderColor:'#8b5cf6', borderWidth:1, pointRadius:0, tension:0.3 },
        { label: 'RSI', data: [], borderColor:'#ff7ab6', borderWidth:1, pointRadius:0, tension:0.3, yAxisID: 'rsi' }
      ]
    },
    options: {
      animation:false,
      responsive:true,
      maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:false}},
      scales: {
        x: { display:false },
        y: { display:false },
        rsi: { display:false, min:0, max:100, position:'right', grid:{display:false} }
      },
      elements: { point: { radius: 0 } }
    }
  };
  pair.charts.main = new Chart(ctx, cfg);
  updateAllIndicatorsForPair(pair, idx);
});

/* ---------- Utils ---------- */
function generateInitialPrices(len){
  const arr = [];
  let p = 100 + Math.random()*50;
  for(let i=0;i<len;i++){
    p = Math.max(1, p + (Math.random()-0.5)*3);
    arr.push(Number(p.toFixed(2)));
  }
  return arr;
}
function smaArray(prices, period){
  const out = [];
  for(let i=0;i<prices.length;i++){
    if(i < period-1){ out.push(null); continue; }
    let sum=0;
    for(let j=i-period+1;j<=i;j++) sum += prices[j];
    out.push(Number((sum/period).toFixed(6)));
  }
  return out;
}
function emaArray(prices, period){
  const out=[];
  const k = 2/(period+1);
  let ema = prices[0];
  out.push(Number(ema.toFixed(6)));
  for(let i=1;i<prices.length;i++){
    ema = prices[i]*k + ema*(1-k);
    out.push(Number(ema.toFixed(6)));
  }
  return out;
}
function bollinger(prices, period=20, mult=2){
  const upper = [], lower = [], middle = smaArray(prices, period);
  for(let i=0;i<prices.length;i++){
    if(i < period-1){ upper.push(null); lower.push(null); continue; }
    let mean = middle[i];
    let sum=0;
    for(let j=i-period+1;j<=i;j++){ sum += Math.pow(prices[j]-mean,2); }
    const sd = Math.sqrt(sum/period);
    upper.push(Number((mean + mult*sd).toFixed(6)));
    lower.push(Number((mean - mult*sd).toFixed(6)));
  }
  return {upper, lower, middle};
}
function rsiArray(prices, period=14){
  const out=[];
  let gains=0, losses=0;
  for(let i=1;i<prices.length;i++){
    const change = prices[i] - prices[i-1];
    gains = (gains*(period-1) + Math.max(change,0)) / period;
    losses = (losses*(period-1) + Math.max(-change,0)) / period;
    const rs = losses === 0 ? 100 : gains / losses;
    const val = 100 - (100/(1+rs));
    out.push(Number(val.toFixed(6)));
  }
  out.unshift(null);
  while(out.length < prices.length) out.push(null);
  return out;
}
function macdArrays(prices, fast=12, slow=26, sig=9){
  const emaFast = emaArray(prices, fast);
  const emaSlow = emaArray(prices, slow);
  const macdLine = prices.map((_,i)=> (emaFast[i] == null || emaSlow[i] == null) ? null : Number((emaFast[i] - emaSlow[i]).toFixed(6)) );
  const sigArr = [];
  let ema = macdLine.find(v => v !== null) || 0;
  for(let i=0;i<macdLine.length;i++){
    const v = macdLine[i];
    if(v === null){ sigArr.push(null); continue; }
    if(sigArr.filter(x=>x!==null).length < sig-1){
      sigArr.push(null);
      ema = v;
      continue;
    }
    ema = (v * (2/(sig+1))) + (ema * (1 - (2/(sig+1))));
    sigArr.push(Number(ema.toFixed(6)));
  }
  const hist = macdLine.map((v,i)=> (v === null || sigArr[i] === null) ? null : Number((v - sigArr[i]).toFixed(6)) );
  return {macdLine, signal: sigArr, hist};
}

/* ---------- Update Indicators ---------- */
function updateAllIndicatorsForPair(pair, idx){
  const prices = pair.prices;
  const chart = pair.charts.main;
  if(!chart) return;

  const sma5 = smaArray(prices, 5);
  const ema12 = emaArray(prices, 12);
  const bb = bollinger(prices, 20, 2);
  const rsi = rsiArray(prices, 14);
  const macd = macdArrays(prices,12,26,9);

  const ds = chart.data.datasets;
  ds[0].data = prices.slice();
  ds[1].data = sma5;
  ds[2].data = ema12;
  ds[3].data = bb.upper;
  ds[4].data = bb.lower;
  ds[5].data = macd.hist;
  ds[5].backgroundColor = macd.hist.map(v => v===null ? 'rgba(0,0,0,0)' : (v>=0 ? 'rgba(6,214,160,0.8)' : 'rgba(239,71,111,0.9)'));
  ds[6].data = macd.macdLine;
  ds[7].data = rsi;

  chart.data.labels = prices.map((_,i) => i);
  chart.update('none');
  document.getElementById(`p${idx}`).innerText = prices[prices.length-1].toFixed(2);
}

/* ---------- Simulation ---------- */
function simulateTick(){
  pairs.forEach((pair, idx) => {
    const last = pair.prices[pair.prices.length-1];
    const drift = (Math.random()-0.5) * 1.8;
    const newPrice = Math.max(0.0001, Number((last + drift).toFixed(4)));
    pair.prices.push(newPrice);
    if(pair.prices.length > 60) pair.prices.shift();

    updateAllIndicatorsForPair(pair, idx);

    const sma5 = smaArray(pair.prices,5).slice(-1)[0];
    const ema12 = emaArray(pair.prices,12).slice(-1)[0];
    let signal = 'HOLD';
    if(sma5 !== null && ema12 !== null){
      if(ema12 > sma5) signal = 'BUY';
      else if(ema12 < sma5) signal = 'SELL';
    }
    if(!pair.lastSignal) pair.lastSignal = signal;
    if(signal !== pair.lastSignal){
      const cls = signal === 'BUY' ? 'buy' : (signal === 'SELL' ? 'sell' : 'hold');
      showToast(`${pair.name} â†’ ${signal} @ ${newPrice.toFixed(4)}`, cls);
      pair.lastSignal = signal;
    }
  });
}
setInterval(simulateTick, 1200);

/* ---------- Toast Queue System ---------- */
let toastQueue = [];
let showingToast = false;
function processQueue(){
  if(showingToast || toastQueue.length===0) return;
  showingToast = true;
  const {msg,type} = toastQueue.shift();
  const t = document.createElement('div');
  t.className = 'toast ' + (type==='buy' ? 'buy' : (type==='sell' ? 'sell' : 'hold'));
  t.innerText = msg;
  toastContainer.appendChild(t);
  try{
    if(type==='buy') document.getElementById('soundBuy').play();
    else if(type==='sell') document.getElementById('soundSell').play();
    else document.getElementById('soundHold').play();
  }catch(e){}
  setTimeout(()=>{
    t.remove();
    showingToast = false;
    processQueue();
  }, 3500);
}
function showToast(msg, type='hold'){
  toastQueue.push({msg,type});
  processQueue();
}
</script>
</body>
</html>
